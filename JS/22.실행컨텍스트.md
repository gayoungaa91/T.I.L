## 실행컨텍스트

1. 전역코드: 전역스코프 생성, 전역코드가 평가되면 전역콘텍스트가 생성된다.
2. 함수코드: 함수코드는 지역스코프 생성, 전역스코프의 일원이 되야한다. 함수코드가 평가되면 함수 실행 컨텍스트 생성
3. Eval코드: 엄격모드에서 자신만의 독자적인 스코프생성, eval 코드가 평가되면, eval 실행컨텍스트 생성
4. 모듈코드: 모듈별로 독립적인 스코프 생성, 모듈코드가 평가되면 모듈 실행컨텍스트가 생성



##### 모든 실행 가능한 코드는 실행에 앞서 **`평가과정`**을 거치면서 코드 실행을 위한 준비를 한다.

-  평가과정

1. 실행컨텍스트 생성
2. 선언문 평가
3. 실행 컨텍스트에 등록

- 실행
1. 실행에 필요한 정보를 실행컨텍스트에서 취득
2. 실행 결과는 실행컨텍스트에서 관리



#### 실행컨텍스트의 역할

1. 전역 코드 평가
   - 변수 선언문과 함수선언문은 전역 스코프에 등록된다.
   - var 키워드는 전역 객체의 프로퍼티가 된다.
2. 전역 코드 실행
   - 전역 코드가 실행되며 변수에 할당되고, 함수가 호출된다.
   - 함수가 호출되면, 코드 실행을 일시 중단하고 함수 내부로 진입한다.
3. 함수 코드 평가
  
   - 매개변수, 지역변수, argument 객체도 지역스코프에 등록된다.
4. 함수 코드 실행
   - 식별자는 `스코프 체인`에서 검색 가능하며, 프로퍼티는 `	프로토타입 체인` 에서 검색 가능하다.
   - 전역 객체의 프로퍼티는 전역변수처럼 전역스코프에서 검색 가능해야 한다.
   - console.log에서 log프로퍼티를 찾을때, console 객체의 프로토타입 체인을 통해 검색한다.
   
   

#### 실행컨텍스트 스택 (콜 스택 Call stack)

- stack 자료구조로 관리된다.
- 코드의 실행 순서를 관리한다.
- 실행컨텍스트가 생성되면`실행컨텍스트스택` 의 최상위에 쌓인다. 스택의 최상위는 실행중인 실행컨텍스트다.



> 스택(stack)

마지막에 넣은 데이터를 먼저 꺼내는 `후입선출`방식의 자료구조다.
스택에서 데이터를 넣는것을 푸시(push)라하고 스택에서 데이터를 꺼내는 것을 팝(pop)이라 한다.



> 큐(queue)

가장 먼저 넣은 데이터를 먼저 꺼내는 `선입선출`방식의 자료구조다.
큐는 데이터를 넣은 순서대로 취득한다.



#### 동기식 처리모델과 비동기식 처리모델

- 자바스크립트 엔진은 단 하나의 실행 컨텍스트 스택을 갖는다. 이는 싱글 스레드(single thread)로 동작한다는 것을 의미한다.
- 자바스크립트는 비동기식 처리 모델을 지원하며, 싱글 스레드의 약점을 보완한다.



### 렉시컬 환경(Lexical Environment)

- 식별자가 선언되는 환경을 말한다. 즉 렉시컬 스코프를 의미한다
- **스코프와 식별자를 관리한다. 그리고 식별자에 바인딩된 값을 관리한다.**
- 객체 형태의 스코프(전역, 함수, 블록 스코프)를 만들고 이곳에 식별자를 등록한다.



##### 실행컨텍스트는 2개의 컴포넌트로 구성되며 하나의 동일한 렉시컬 환경을 참조한다.

![image-20191030213725001](/Users/igayeong/Library/Application Support/typora-user-images/image-20191030213725001.png)

##### 렉시컬 환경의 3개의 컴포넌트로 구성된다.

![image-20191030213843356](/Users/igayeong/Library/Application Support/typora-user-images/image-20191030213843356.png)

1. **환경 레코드**: 식별자를 등록하고 식별자에 바인딩된 값을 관리하는 저장소이다.
2. **외부 렉시컬 환경에 대한 참조**: 실행컨텍스트를 생성한 상위 코드의 렉시컬 환경을 말한다. 이를 통해 단방향 링크드 리스트인 스코프 체인을 구현한다.
3. **This 바인딩**: 렉시컬 환경의 this에 바인딩된 객체를 나타낸다.



### 실행컨텍스트의 식별자 검색 과정

![image-20191030214741426](/Users/igayeong/Library/Application Support/typora-user-images/image-20191030214741426.png)

#### 1. 전역 객체 생성

- 전역코드가 평가되기 이전에 생성된다.
- **전역객체** 
	- 전역 프로퍼티
	- 전역 함수
	- 표준 빌트인 객체
	- Web API (DOM, BOM, Canvas, XMLHttpRequest, Fetch, requestAnimationFrame, SVG, Web Storage, Web Component, Web worker 등) 
	- 특정 환경을 위한 호스트 객체
- Object.prototype을 상속받는다.  프로토타입 체인의 일원이다.

#### 2. 전역 코드 평가

1. 전역 실행 컨텍스트
2. 전역 렉시컬 환경 생성
   1. 전역 환경 레코드 생성 : 전역 스코프와 전역 객체를 관리한다.
      1. 객체 환경 레코드 생성
         - var 키워드로 선언된 전역변수와 전역함수는 여기에 등록되고 관리된다.
         - bindingObject 객체와 연결되어 식별자는 이 객체의 프로퍼티가 된다.
         - bindingObject는 전역객체이다.
      2. 선언적 환경 레코드 생성
         - let, const 키워드
         - `선언단계` 와`초기화단계` 분리되어 진행되기 때문에, 변수에 할당되기 이전까지 일시적 사각지대(Temporal Dead Zone)에 빠지게 된다.
   2. 외부 렉시컬 환경에 대한 참조 할당
      - 현재 평가중인 코드 포함 외부 코드의 렉시컬 환경을 말하며, 이를 통해 스코프 체인을 구현한다.
      - 전역 렉시컬 환경의 참조는 null을 할당한다. 
      - 전역 렉시컬 환경이 스코프체인의 최상위에 존재함을 의미한다.
   3. this 바인딩
     - 전역객체가 바인딩 된다.

![image-20191030224652416](/Users/igayeong/Library/Application Support/typora-user-images/image-20191030224652416.png)

#### 3. 전역 코드 실행

- 식별자를 찾을때는 `실행중인 실행컨텍스트의 렉시컬 환경`에서 검색한다.
- `실행중인 실행컨텍스트의 렉시컬 환경`에서 식별자를 찾을 수 없다면, `외부 렉시컬환경`에 대한 참조가 가르키는 렉시컬 환경으로 이동하여 검색하며 이는 스코프 체인의 동작 원리다.
- 변수 할당문은 렉시컬 환경에 등록된 식별자를 검색하여 바인딩 값을 변경한다.
- 함수 호출은 렉시컬 환경에 등록된 식별자를 검색하여 바인딩된 함수 객체를 호출하는 것이다.
- 실행 컨텍스트는 실행 가능한 코드를 평가하고 실행하기 위해 필요한 환경을 제공하고 **코드의 실행 결과를 실제로 관리**하는 영역이다.

#### 4. foo 함수 코드 평가

1. 함수 실행 컨텍스트 생성: **함수 실행컨텍스트는 함수 렉시컬 환경이 완성된 다음, 실행 컨텍스트 스택에 푸시된다.**

2. 함수 렉시컬 환경 생성: 실행컨텍스트 컴포넌트들에 바인딩한다.

   1. 함수 환경 레코드 생성 

      - 매개변수, arguments, 함수 내 선언한 변수와 함수 정의를 등록하고 관리한다.

      ![image-20191031174009114](/Users/igayeong/Library/Application Support/typora-user-images/image-20191031174009114.png)

   2. 외부 렉시컬 환경에 대한 참조 할당

      - foo 함수 정의가 평가된 시점의 실행중인 실행컨텍스트의 렉시컬 환경의 참조가 저장된다.

      - foo함수는 전역 함수이기 때문에, 전역 코드 평가시점에 평가된다. 이때 실행중인 실행컨텍스트는 전역 실행 컨텍스트 이다.
      - 외부 렉시컬 환경에 대한 참조는 `전역 렉시컬 환경`의 참조가 저장된다.

   3. This 바인딩

		- foo함수는 일반함수로 호출되었으므로 this는 window를 가르킨다.

![image-20191031175433885](/Users/igayeong/Library/Application Support/typora-user-images/image-20191031175433885.png)

> 함수 객체의 내부 슬롯 [[Environment]]

- 자바스크립트의 모든 함수는 함수 정의가 평가되어 함수 객체를 생성할 때, 현재 실행중인 실행컨텍스트의 렉시컬 환경을 내부슬롯에 저장한다.
- 함수 객체의 내부 슬롯 [[Environment]]이 렉시컬 스코프를 구현하는 매커니즘이다.

#### 5. foo 함수 코드 실행

- 실행중인 실행 컨텍스트에서 식별자를 검색하여 값을 바인딩 한다.

#### 6. bar 함수 코드 평가
​	![image-20191031183841578](/Users/igayeong/Library/Application Support/typora-user-images/image-20191031183841578.png)
#### 7. bar 함수 코드 실행

- `console.log(a + b + x + y + x);` 실행순서
  1. 식별자 console 검색
     - console 식별자를 스코프 체인에서 검색한다.
     - 현재 실행중인 실행 먼텍스트의 렉시컬 환경에서 검색하기 시작한다.
     - **전역 렉시컬 환경만 **
  2. log 메소드 검색
  3. 표현식 a + b + x + y + z 평가 

#### 8. bar 함수 코드 실행 종료
#### 9. foo 함수 코드 실행 종료
#### 10. 전역 코드 실행 종료



전역코드가 평가될때 전역 실행컨텍스트가 먼저 생성, 렉시컬환경 안에 전역스코프가생겨서 식별자와 바인딩된 값을 관리

전역객체는 전역스코프를 갖는다.

전역객체 브라우저가 켜짐과 동시에 생성되며, 브라우저를 끄기 전까지 살아있다.












<hr>

###### Reference 
[Poiemaweb]: https://poiemaweb.com

